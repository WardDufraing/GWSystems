@use 'variables.scss' as *;
@use 'sass:color';

/* ====== Tunables (global) ====== */
:root {
  --glass-bg: hsla(0 0% 100% / 0.08);
  --glass-tint: hsla(210 90% 60% / 0.08);
  --glass-blur: 18px;
  --glass-radius: 22px;
  --glass-border: 1px;
  --glass-border-outer: hsla(0 0% 100% / 0.14);
  --glass-border-inner: hsla(0 0% 100% / 0.35);
  --glass-shadow: 0 10px 30px -10px rgba(0,0,0,.35), 0 1px 0 rgba(255,255,255,.08) inset;
  --glass-noise-opacity: .05;
  --glare-duration: 3s; /* kept per your request */
  --glare-delay: 2s;    /* kept per your request */
}

/* ====== Process (timeline) scoped vars placed BEFORE usage (C.15) ====== */
.process--timeline {
  --rail-color: rgba(255,255,255,.15);
  --rail-glow: rgba(255,255,255,.45);
  --node-bg: rgba(255,255,255,.08);
  --node-ring: rgba(255,255,255,.25);
  --panel-bg-1: hsla(0 0% 100% / .05);
  --panel-bg-2: hsla(0 0% 100% / .02);
  --panel-blur: 10px;
  --panel-radius: 16px; /* slightly tighter than Services */
  --panel-border: 1px solid rgba(255,255,255,.12);
}

/* ====== Shared: tiny placeholder for glass base (E.20) ====== */
%glass-surface {
  background:
    linear-gradient(0deg, hsla(0 0% 100% / .06), hsla(0 0% 100% / .02));
  -webkit-backdrop-filter: blur(14px);
  backdrop-filter: blur(14px);
  border: 1px solid rgba(255,255,255,.12);
  box-shadow: 0 10px 30px -12px rgba(0,0,0,.35);
  overflow: hidden;
}

/* ===========================================
   HERO
   =========================================== */
section.hero {
  /* A.2: ensure proper blur isolation and base height */
  isolation: isolate;
  overflow: hidden;
  display: grid;
  grid-gap: 1rem;
  place-items: center;
  min-height: 60svh; /* base height for mobile */

  @media screen and (min-width: 1024px) {
    min-height: 60vh; /* kept from your original */
  }

  /* background asset (kept as-is per A.4 skip) */
  .hero-bg {
    position: absolute;
    inset: 0;
    z-index: 0;
    background-image: url('../assets/images/BackgroundAssets/Background_Abstract_3.png');
    background-repeat: no-repeat;
    background-size: 50%;
    background-position: -30% 0%;
  }

  .glass-card {
    /* A.1 skipped: not adding base glass props */
    z-index: 10;
    text-align: left;
    display: flex;
    flex-direction: column;
    gap: 1rem;

    &::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events: none;
      background:
        radial-gradient(120% 100% at 50% -20%, rgba(255,255,255,.16), transparent 50%),
        radial-gradient(90% 60% at 50% 100%, rgba(255,255,255,.06), transparent 70%);
      mix-blend-mode: screen;
    }

    .glass-border {
      position: absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events: none;
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      mask-composite: exclude;
      padding: var(--glass-border);
      background:
        conic-gradient(from 180deg at 50% 50%,
          hsla(0 0% 100% / .6),
          hsla(200 80% 70% / .5),
          hsla(300 80% 70% / .4),
          hsla(0 0% 100% / .6) 360deg);
      opacity: .65;
    }

    .glass-noise {
      position: absolute;
      inset: -50%;
      pointer-events: none;
      background-image:
        radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,.5), transparent),
        radial-gradient(1px 1px at 60% 70%, rgba(255,255,255,.5), transparent),
        radial-gradient(1px 1px at 80% 20%, rgba(255,255,255,.5), transparent),
        radial-gradient(1px 1px at 40% 80%, rgba(255,255,255,.5), transparent);
      background-size: 180px 180px, 190px 190px, 200px 200px, 210px 210px;
      opacity: var(--glass-noise-opacity);
      filter: contrast(120%);
      mix-blend-mode: overlay;
    }

    .glass-glare {
      position: absolute;
      inset: -20% -60%;
      pointer-events: none;
      transform: rotate(8deg) skewX(-12deg);
      background:
        linear-gradient(90deg,
          transparent 0%,
          rgba(255,255,255,.02) 20%,
          rgba(255,255,255,.45) 48%,
          rgba(255,255,255,.06) 60%,
          transparent 75%);
      filter: blur(6px);
      opacity: 0;
      /* A.3 skipped: keep your timing as-is */
      animation: glare-sweep var(--glare-duration) cubic-bezier(.18,.72,.15,1) var(--glare-delay) 1 both;
    }

    h1 {
      font-size: 2rem;
      /* A.5 skipped: keep your accent text-shadow */
      text-shadow: 1px 1px 2px $accent-color;
      font-weight: normal;
      @media screen and (min-width: 636px) { font-size: 3.5rem; }
    }

    .cta {
      /* A.6: normalize spacing */
      padding: 1em 0;
      margin-top: clamp(.6rem, 2.5vw, 1.2rem);
      display: flex;
      gap: .8rem;
      flex-wrap: wrap;
    }
  }
}

@keyframes glare-sweep {
  0%   { transform: translateX(-40%) rotate(8deg) skewX(-12deg); opacity: 0; }
  12%  { opacity: .8; }
  45%  { opacity: .85; }
  100% { transform: translateX(110%) rotate(8deg) skewX(-12deg); opacity: 0; }
}

/* ===========================================
   SERVICES
   =========================================== */
section.services {
  position: relative;
  isolation: isolate;
  padding: clamp(48px, 8vw, 96px) 20px; /* B.10: vertical rhythm */

  .wrap {
    margin: 0 auto;
    max-width: 1200px; /* B.10: consistent width cap */

    .services-head {
      text-align: center;
      max-width: 800px;
      margin: 0 auto clamp(28px, 5vw, 48px);

      .eyebrow {
        letter-spacing: .18em;
        text-transform: uppercase;
        font-size: .8rem;
        opacity: .7;
        margin-bottom: .4rem;
      }

      h2 {
        font-size: clamp(1.8rem, 3.2vw, 2.4rem);
        letter-spacing: -0.015em;
        margin: 0 0 .6rem;
      }

      .lead { opacity: .8; }
    }

    .service-grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: clamp(14px, 2.4vw, 22px);
      margin: 0;
      padding: 0;

      .service-card {
        list-style: none;
        grid-column: span 12;
        position: relative;
        padding: clamp(18px, 2.2vw, 28px);
        @extend %glass-surface;
        transform: translateZ(0);

        /* B.8: add rim + grain as pseudo-elements (no markup change) */
        &::after {
          /* rim */
          content: "";
          position: absolute; inset: 0; border-radius: 20px; pointer-events: none;
          -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
          -webkit-mask-composite: xor;
          mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
          mask-composite: exclude;
          padding: 1px;
          background:
            conic-gradient(from 180deg at 50% 50%,
              hsla(0 0% 100% / .55),
              hsla(200 80% 70% / .45),
              hsla(300 80% 70% / .35),
              hsla(0 0% 100% / .55) 360deg);
          opacity: .6;
        }
        &::before {
          /* grain */
          content: "";
          position: absolute; inset: -40%; pointer-events: none;
          background-image:
            radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,.45), transparent),
            radial-gradient(1px 1px at 60% 70%, rgba(255,255,255,.45), transparent),
            radial-gradient(1px 1px at 80% 20%, rgba(255,255,255,.45), transparent),
            radial-gradient(1px 1px at 40% 80%, rgba(255,255,255,.45), transparent);
          background-size: 180px 180px, 190px 190px, 200px 200px, 210px 210px;
          opacity: .05; mix-blend-mode: overlay;
        }

        &.popular {
          /* B.7 skipped: keep .popular naming */
          background:
            linear-gradient(0deg, hsla(210 90% 60% / .10), hsla(0 0% 100% / .03));
          border-color: rgba(255,255,255,.18);
        }

        .badge {
          position: absolute; top: 12px; left: 12px;
          font-size: .72rem; letter-spacing: .08em; text-transform: uppercase;
          background: rgba(255,255,255,.08);
          border: 1px solid rgba(255,255,255,.18);
          padding: 4px 8px; border-radius: 999px;
          backdrop-filter: blur(6px);
        }

        .icon {
          width: 48px; height: 48px; display: grid; place-items: center;
          border-radius: 14px;
          background:
            radial-gradient(120% 120% at 10% 0%, rgba(255,255,255,.2), transparent),
            linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04));
          border: 1px solid rgba(255,255,255,.18);
          margin: .8rem auto;
        }

        h3 {
          margin: 0 0 .2rem;
          font-size: clamp(1.05rem, 1.6vw, 1.25rem);
          letter-spacing: -0.01em;
        }

        .sub { margin: 0 0 .7rem; opacity: .85; }
        .bullets {
          margin: 0 0 .9rem; padding-left: 1.1rem;
          display: grid; gap: .25rem; text-align: left;
        }

        .text-link {
          display: inline-flex; align-items: center; gap: .4rem;
          text-decoration: none;
          border-bottom: 1px dashed rgba(255,255,255,.35);
          color: rgba(255,255,255,.85);
          transition: color .25s ease, border-color .25s ease, transform .25s ease;
          padding-bottom: 2px;
          opacity: .9;

          &:hover {
            color: rgba(255,255,255,1);
            border-color: rgba(255,255,255,.5);
            transform: translateX(2px);
          }
          &:focus-visible {
            outline: 2px solid rgba(255,255,255,.5);
            outline-offset: 2px;
            border-color: transparent;
          }
        }

        transition: transform .36s cubic-bezier(.2,.8,.2,1), box-shadow .36s ease, border-color .36s ease;
        &:hover {
          transform: translateY(-4px);
          box-shadow: 0 22px 50px -20px rgba(0,0,0,.5);
          border-color: rgba(255,255,255,.24);
        }
        &:focus-within {
          outline: 2px solid rgba(255,255,255,.5);
          outline-offset: 2px;
        }

        @media (min-width: 680px) { grid-column: span 6; }
        @media (min-width: 1024px) { grid-column: span 3; }
      }
    }

    .services-cta {
      display: flex; gap: .8rem; justify-content: center;
      margin-top: clamp(20px, 4vw, 36px);
    }
  }
}

/* ===========================================
   PROCESS (TIMELINE)
   =========================================== */
section.process {
  /* rail container */
  .timeline-rail{
    position: relative;
    width: 2px;
    background: linear-gradient(180deg, var(--rail-color), var(--rail-color));
    margin: 0 auto;
    height: 100%;
    transform: translateX(0);
    overflow: hidden;

    &::before{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(180deg,
        rgba(255,255,255,0) 0%,
        rgba(255,255,255,.35) 25%,
        rgba(255,255,255,0) 50%,
        rgba(255,255,255,.35) 75%,
        rgba(255,255,255,0) 100%);
      animation: rail-sheen 1.6s ease .2s 1 both;
    }
  }

  /* desktop rail placement */
  @media (min-width: 900px){
    .timeline-rail{
      position: absolute;
      left: 50%;
      top: clamp(120px, 16vh, 180px);
      bottom: clamp(60px, 10vh, 120px);
      margin: 0;
    }
  }

  .process-steps{
    position: relative;
    display: grid;
    gap: clamp(22px, 3vw, 32px);
    margin: clamp(22px, 4vw, 36px) 0 0;

    .step{
      position: relative;
      list-style: none;
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: start;
      gap: 14px;

      .node{
        grid-column: 2;
        justify-self: center;
        width: 18px; height: 18px; border-radius: 999px;
        background: var(--node-bg);
        border: 2px solid var(--node-ring);
        box-shadow: 0 0 12px -2px var(--rail-glow);
        position: relative;

        &::after{
          content:"";
          position:absolute; inset:-10px; border-radius:999px;
          background: radial-gradient(closest-side, rgba(255,255,255,.35), transparent 70%);
          opacity:.35; pointer-events:none;
        }

        .node-num{
          position: absolute; left: 50%; top: 50%; transform: translate(-50%,-170%);
          font-size: .8rem; opacity: .7; letter-spacing: .05em;
        }
      }

      .panel{
        grid-column: 1; /* odd: left */
        border-radius: var(--panel-radius);
        background:
          linear-gradient(180deg, var(--panel-bg-1), var(--panel-bg-2));
        backdrop-filter: blur(var(--panel-blur));
        -webkit-backdrop-filter: blur(var(--panel-blur));
        border: var(--panel-border);
        padding: clamp(14px, 2vw, 22px);
        position: relative;
        box-shadow: 0 10px 24px -14px rgba(0,0,0,.5);

        /* headings inside panel */
        h3{ margin:0 0 .25rem; font-size: clamp(1.02rem, 1.4vw, 1.18rem); letter-spacing:-0.01em; }
        .sub{ margin:.2rem 0 .6rem; opacity:.85; }
        .bullets{ margin:0 0 .7rem; padding-left:1.1rem; display:grid; gap:.25rem; }
        .meta{ opacity:.65; }

        /* C.13: entrance animation + reduced motion targeting actual elements */
        opacity: 0; transform: translateY(6px);
        animation: panel-in .5s cubic-bezier(.2,.8,.2,1) .25s 1 forwards;

        /* C.14: subtle connector, nudged 1px to avoid retina gaps */
        &::before{
          content:"";
          position:absolute; top: 20px; width: 23px; height: 2px;
          background: linear-gradient(90deg, var(--rail-color), rgba(255,255,255,.0));
          opacity:.7;
        }
      }

      &:nth-child(even) .panel{
        grid-column: 3; /* even: right */
        &::before{
          left: calc(100% - 1px); /* small nudge to overlap 1px */
          transform: scaleX(-1);
        }
      }

      &:nth-child(odd) .panel::before{
        right: calc(100% - 1px); /* small nudge to overlap 1px */
      }

      /* Staggered delays */
      &:nth-child(2) .panel{ animation-delay: .35s; }
      &:nth-child(3) .panel{ animation-delay: .45s; }
      &:nth-child(4) .panel{ animation-delay: .55s; }
    }
  }
}

/* C.12: MOBILE scoping fix â€” this targets siblings correctly */
@media (max-width: 899px){
  section.process {
    .timeline-rail{
      position: absolute; left: 24px; top: 0; bottom: 0; width: 2px;
    }
    .process-steps{
      grid-template-columns: 24px 12px 1fr;
      .panel{ grid-column: 3; }
      .node .node-num{ transform: translate(-50%,-180%); }
    }
  }
}

/* ===========================================
   KEYFRAMES
   =========================================== */
@keyframes rail-sheen { to { transform: translateY(100%); opacity:.0; } }
@keyframes panel-in   { to { opacity: 1; transform: translateY(0); } }
@keyframes progress-grow { to { width: 100%; } }

/* ===========================================
   CONTENT (unchanged)
   =========================================== */
section.content{
  text-align: center;
  display: flex;
  grid-gap: 1rem;
  place-items: center;
  flex-direction: column;

  @media screen and (min-width: 1024px) {
    flex-direction: row;
    text-align: left;
    justify-content: space-between;
  }

  .contentImage{
    width: 100%;
    max-width: 80vw;
    height: auto;

    @media screen and (min-width: 1024px) {
      width: 100%;
      max-width: 30vw;
      height: auto;
    }
  }
}
