---
const pathname = Astro.url.pathname;
const isActive = (href) => {
  if (href === "/") return pathname === "/";
  return pathname === href || pathname.startsWith(href + "/");
};

const links = [
  { href: "/work", label: "Work" },
  { href: "/services", label: "Services" },
  { href: "/about", label: "About" },
  { href: "/contact", label: "Contact" },
];
---

<div class="mobile-menu" data-mobile-menu aria-hidden="true">
    <button
      class="mobile-menu__backdrop"
      type="button"
      aria-label="Close menu"
      data-nav-backdrop
    ></button>
    <div class="mobile-menu__panel" role="dialog" aria-modal="true">
      <div class="mobile-menu__top">
        <span class="mobile-menu__brand">Studio Fraktal</span>
  
        <button
          class="mobile-menu__close"
          type="button"
          aria-label="Close menu"
          data-nav-close
        >
          ✕
        </button>
      </div>
  
      <nav class="mobile-menu__nav" aria-label="Mobile navigation">
        {links.map((l) => (
          <a
            href={l.href}
            data-nav-link
            class:list={[isActive(l.href) && "is-active"]}
            aria-current={isActive(l.href) ? "page" : undefined}
          >
            {l.label}
          </a>
        ))}
      </nav>
  
      <div class="mobile-menu__cta">
        <a class="btn btn--primary btn--full" href="/contact" data-nav-link>
          Let’s talk
        </a>
      </div>
    </div>
  
    <script>
      (() => {
        const header = document.querySelector("[data-header]");
        if (!header) return;
  
        const toggle = header.querySelector("[data-nav-toggle]");
        const menu = header.querySelector("[data-mobile-menu]");
        const closeBtn = header.querySelector("[data-nav-close]");
        const backdrop = header.querySelector("[data-nav-backdrop]");
        const links = header.querySelectorAll("[data-nav-link]");
  
        const setOpen = (open) => {
          header.classList.toggle("is-menu-open", open);
          toggle?.setAttribute("aria-expanded", open ? "true" : "false");
          menu?.setAttribute("aria-hidden", open ? "false" : "true");
          document.documentElement.classList.toggle("no-scroll", open);
        };
  
        toggle?.addEventListener("click", () => {
          const open = !header.classList.contains("is-menu-open");
          setOpen(open);
        });
  
        closeBtn?.addEventListener("click", () => setOpen(false));
        backdrop?.addEventListener("click", () => setOpen(false));
        links.forEach(l => l.addEventListener("click", () => setOpen(false)));
  
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") setOpen(false);
        });
      })();
    </script>
  </div>
  